---
- hosts: all
  become: true
  
  tasks:
  - name: Install unzip
    apt:
      name: unzip
      state: present

  - name: Download awscli installer
    unarchive:
      src: https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip
      dest: /tmp
      remote_src: true
      creates: /tmp/aws
      mode: 0755

  - name: Run installer
    command:
    args:
      cmd: /tmp/aws/install
      creates: /usr/local/bin/aws
    register: aws_install

  - name: Check awscli version 
    command: sudo aws --version
    register: aws_version
  - debug:
      var: aws_version.stdout

  - name: Create test file
    command: echo "test S3 upload" > myfile.txt
  
  - name: Check test file creation 
    command: sudo cat myfile.txt
    register: myfile
  - debug:
      var: myfile.stdout

  
  